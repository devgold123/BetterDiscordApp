function Core(){}function EmoteModule(){}function PublicServers(){}function QuickEmoteMenu(){}function CustomCssEditor(){}function SettingsPanel(){utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.9.0/codemirror.min.js"),utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.9.0/mode/css/css.min.js"),utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.4.2/Sortable.min.js")}function Utils(){}function VoiceMode(){}function PluginModule(){}function ThemeModule(){}function BdWSocket(){bdws=this}function BdApi(){}var settingsPanel,emoteModule,utils,quickEmoteMenu,opublicServers,voiceMode,pluginModule,themeModule,customCssEditor,jsVersion=1.72,supportedVersion="0.2.5",mainObserver,twitchEmoteUrlStart="https://static-cdn.jtvnw.net/emoticons/v1/",twitchEmoteUrlEnd="/1.0",ffzEmoteUrlStart="https://cdn.frankerfacez.com/emoticon/",ffzEmoteUrlEnd="/1",bttvEmoteUrlStart="https://cdn.betterttv.net/emote/",bttvEmoteUrlEnd="/1x",mainCore,settings={"Save logs locally":{id:"bda-gs-0",info:"Saves chat logs locally",implemented:!1,hidden:!1,cat:"core"},"Public Servers":{id:"bda-gs-1",info:"Display public servers button",implemented:!0,hidden:!1,cat:"core"},"Minimal Mode":{id:"bda-gs-2",info:"Hide elements and reduce the size of elements.",implemented:!0,hidden:!1,cat:"core"},"Voice Mode":{id:"bda-gs-4",info:"Only show voice chat",implemented:!0,hidden:!1,cat:"core"},"Hide Channels":{id:"bda-gs-3",info:"Hide channels in minimal mode",implemented:!0,hidden:!1,cat:"core"},"Dark Mode":{id:"bda-gs-5",info:"Make certain elements dark by default(wip)",implemented:!0,hidden:!1,cat:"core"},"Override Default Emotes":{id:"bda-es-5",info:"Override default emotes",implemented:!1,hidden:!1,cat:"core"},"Voice Disconnect":{id:"bda-dc-0",info:"Disconnect from voice server when closing Discord",implemented:!0,hidden:!1,cat:"core"},"Custom css live update":{id:"bda-css-0",info:"",implemented:!0,hidden:!0,cat:"core"},"Custom css auto udpate":{id:"bda-css-1",info:"",implemented:!0,hidden:!0,cat:"core"},"24 Hour Timestamps":{id:"bda-gs-6",info:"Replace 12hr timestamps with proper ones",implemented:!0,hidden:!1,cat:"core"},"Coloured Text":{id:"bda-gs-7",info:"Make text colour the same as role colour",implemented:!0,hidden:!1,cat:"core"},"Twitch Emotes":{id:"bda-es-7",info:"Show Twitch emotes",implemented:!0,hidden:!1,cat:"emote"},"FrankerFaceZ Emotes":{id:"bda-es-1",info:"Show FrankerFaceZ Emotes",implemented:!0,hidden:!1,cat:"emote"},"BetterTTV Emotes":{id:"bda-es-2",info:"Show BetterTTV Emotes",implemented:!0,hidden:!1,cat:"emote"},"Emote Menu":{id:"bda-es-0",info:"Show Twitch/Favourite emotes in emote menu",implemented:!0,hidden:!1,cat:"emote"},"Emoji Menu":{id:"bda-es-9",info:"Show Discord emoji menu",implemented:!0,hidden:!1,cat:"emote"},"Emote Autocomplete":{id:"bda-es-3",info:"Autocomplete emote commands",implemented:!1,hidden:!1,cat:"emote"},"Emote Auto Capitalization":{id:"bda-es-4",info:"Autocapitalize emote commands",implemented:!0,hidden:!1,cat:"emote"},"Show Names":{id:"bda-es-6",info:"Show emote names on hover",implemented:!0,hidden:!1,cat:"emote"},"Show emote modifiers":{id:"bda-es-8",info:"Enable emote mods",implemented:!0,hidden:!1,cat:"emote"}},links={"Jiiks.net":{text:"Jiiks.net",href:"thtp://jiiks.net",target:"_blank"},twitter:{text:"Twitter",href:"http://twitter.com/jiiksi",target:"_blank"},github:{text:"Github",href:"http://github.com/jiiks",target:"_blank"}},defaultCookie={version:jsVersion,"bda-gs-0":!1,"bda-gs-1":!0,"bda-gs-2":!1,"bda-gs-3":!1,"bda-gs-4":!1,"bda-gs-5":!0,"bda-gs-6":!1,"bda-gs-7":!1,"bda-es-0":!0,"bda-es-1":!0,"bda-es-2":!0,"bda-es-3":!1,"bda-es-4":!1,"bda-es-5":!0,"bda-es-6":!0,"bda-es-7":!0,"bda-es-8":!0,"bda-jd":!0,"bda-es-8":!0,"bda-dc-0":!1,"bda-css-0":!1,"bda-css-1":!1,"bda-es-9":!0},bdchangelog={changes:{a:{title:"v1.72 : Public Servers",text:"Public servers now have categories, description, tags, dark mode and more!",img:""},b:{title:"v1.72 : Import/Export",text:"Import/Export buttons now disappear in themes/plugins tabs to avoid confusion",img:""},c:{title:"v1.72 : Changelog",text:"You can now reopen this changelog from the settings",img:""},d:{title:"v1.71 : Hide Twitch emotes",text:"Hide all emotes option now toggles Twitch emotes instead!",img:""},e:{title:"v1.71 : Override FFZ emote",text:'Use the <code class="inline">:bttv</code> emote modifier to override a FFZ emote with a BTTV one!',img:""},f:{title:"v1.70 : 0.2.8 Support",text:"Added support for Core version 0.2.8.",img:""},g:{title:"v1.70 : Setting Import/Export",text:"You can now import and export your settings!",img:""},h:{title:"v1.70 : Public Server List Infinite Scroll",text:"Public server list now has the ability to load more than 20 servers.",img:""},i:{title:"v1.70 : 24 hour timestamps",text:"Replace 12 hour timestamp with 24 hour timestamps!",img:""},j:{title:"v1.70 : Coloured text",text:"Make text colour the same as role colour!",img:""}},fixes:{a:{title:"v1.72 : Settings panel",text:"Settings panel will now show no matter how you open it!",img:""},b:{title:"v1.72 : Fixed emote edit bug",text:"Edits now appear properly even with emotes!",img:""},c:{title:"v1.72 : Public servers",text:"Public servers button is visible again!",img:""},d:{title:"v1.72 : Public servers",text:"Updated public servers api endpoint url for fetching correct serverlist.",img:""},e:{title:"v1.71 : Fixed emotes and edit",text:"Emotes work again! So does editing emotes!",img:""},f:{title:"Spoilers are currently broken :(",text:"Ps. I know this in the fixes section :o",img:""}}},settingsCookie={};Core.prototype.init=function(){function e(){if(console.log((new Date).getTime()+" Defer"),$(".guilds-wrapper .guilds").children().length>0){console.log((new Date).getTime()+" Defer Loaded");var s=($(".guilds>li:first-child"),$("<button/>",{"class":"btn",id:"bd-show-channels",text:"R",css:{cursor:"pointer"},click:function(){settingsCookie["bda-gs-3"]=!1,$("body").removeClass("bd-minimal-chan"),t.saveSettings()}}));if($(".guilds-wrapper").prepend(s),opublicServers=new PublicServers,customCssEditor=new CustomCssEditor,pluginModule=new PluginModule,pluginModule.loadPlugins(),"undefined"!=typeof themesupport2&&(themeModule=new ThemeModule,themeModule.loadThemes()),settingsPanel=new SettingsPanel,settingsPanel.init(),quickEmoteMenu.init(!1),$("#tc-settings-button").on("click",function(){settingsPanel.show()}),window.addEventListener("beforeunload",function(){settingsCookie["bda-dc-0"]&&$(".btn.btn-disconnect").click()}),$(document).on("mousedown",function(e){}),opublicServers.init(),emoteModule.autoCapitalize(),settingsCookie.version<jsVersion){var i=t.constructChangelog();$("body").append(i),settingsCookie.version=jsVersion,t.saveSettings()}$("head").append("<style>.CodeMirror{ min-width:100%; }</style>"),$("head").append('<style id="bdemotemenustyle"></style>')}else setTimeout(e,100)}var t=this,s="undefined"==typeof version?bdVersion:version;if(supportedVersion>s)return void this.alert("Not Supported","BetterDiscord v"+s+"(your version) is not supported by the latest js("+jsVersion+").<br><br> Please download the latest version from <a href='https://betterdiscord.net' target='_blank'>BetterDiscord.net</a>");utils=new Utils;var i=new BdWSocket;i.start(),utils.getHash(),emoteModule=new EmoteModule,quickEmoteMenu=new QuickEmoteMenu,voiceMode=new VoiceMode,emoteModule.init(),this.initSettings(),this.initObserver(),$(document).ready(function(){setTimeout(e,1e3)})},Core.prototype.initSettings=function(){if(void 0==$.cookie("better-discord"))settingsCookie=defaultCookie,this.saveSettings();else{this.loadSettings();for(var e in defaultCookie)void 0==settingsCookie[e]&&(settingsCookie[e]=defaultCookie[e],this.saveSettings())}},Core.prototype.saveSettings=function(){$.cookie("better-discord",JSON.stringify(settingsCookie),{expires:365,path:"/"})},Core.prototype.loadSettings=function(){settingsCookie=JSON.parse($.cookie("better-discord"))};var botlist=["119598467310944259"];Core.prototype.initObserver=function(){mainObserver=new MutationObserver(function(e){e.forEach(function(e){if(void 0!==settingsPanel&&settingsPanel.inject(e),$(e.target).find(".emoji-picker").length){var t=e.target.firstChild;t.classList.contains("popout")&&quickEmoteMenu.obsCallback($(t))}"undefined"!=typeof pluginModule&&pluginModule.rawObserver(e),null!=e.target.getAttribute("class")&&((e.target.classList.contains("title-wrap")||e.target.classList.contains("chat"))&&(voiceMode.obsCallback(),"undefined"!=typeof pluginModule&&pluginModule.channelSwitch()),-1!=e.target.getAttribute("class").indexOf("scroller messages")&&"undefined"!=typeof pluginModule&&pluginModule.newMessage(),settingsCookie["bda-gs-6"]&&$(".timestamp").not("[data-24]").each(function(){var e=$(this);e.attr("data-24",!0);var t=e.text(),s=/(.*)?at\s+(\d{1,2}):(\d{1,2})\s+(.*)/.exec(t);if(null==s)return!0;if(s.length<5)return!0;var i=parseInt(s[2]);"AM"==s[4]?12==i&&(i-=12):"PM"==s[4]&&12>i&&(i+=12),s[2]=("0"+i).slice(-2),e.text(s[1]+" at "+s[2]+":"+s[3])}),settingsCookie["bda-gs-7"]&&$(".user-name").not("[data-colour]").each(function(){var e=$(this),t=e.css("color");return"rgb(255, 255, 255)"==t?!0:void e.closest(".message-group").find(".markup").not("[data-colour]").each(function(){$(this).attr("data-colour",!0),$(this).css("color",t)})})),emoteModule.obsCallback(e)})}),mainObserver.observe(document,{childList:!0,subtree:!0})},Core.prototype.constructChangelog=function(){var e='<div id="bd-wn-modal" class="modal" style="opacity:1;">  <div class="modal-inner">       <div id="bdcl" class="markdown-modal change-log">            <div class="markdown-modal-header">               <strong>What\'s new in BetterDiscord JS'+jsVersion+'</strong>               <button class="markdown-modal-close" onclick=\'$("#bd-wn-modal").remove();\'></button>           </div><!--header-->           <div class="scroller-wrap">               <div class="scroller">';if(null!=bdchangelog.changes){e+='<h1 class="changelog-added">   <span>New Stuff</span></h1><ul>';for(var t in bdchangelog.changes)t=bdchangelog.changes[t],e+="<li>   <strong>"+t.title+"</strong>   <div>"+t.text+"</div></li>";e+="</ul>"}if(null!=bdchangelog.fixes){e+='<h1 class="changelog-fixed">   <span>Fixed</span></h1><ul>';for(var s in bdchangelog.fixes)s=bdchangelog.fixes[s],e+="<li>   <strong>"+s.title+"</strong>   <div>"+s.text+"</div></li>";e+="</ul>"}if(null!=bdchangelog.upcoming){e+='<h1 class="changelog-in-progress">   <span>Coming Soon</span></h1><ul>';for(var i in bdchangelog.upcoming)i=bdchangelog.upcoming[i],e+="<li>   <strong>"+i.title+"</strong>   <div>"+i.text+"</div></li>";e+="</ul>"}return e+='               </div><!--scoller-->           </div><!--scroller-wrap-->           <div class="footer">           </div><!--footer-->       </div><!--change-log-->   </div><!--modal-inner--></div><!--modal-->'},Core.prototype.alert=function(e,t){for(var s="",i=0;5>i;i++)s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".length));var o='    <div id="bda-alert-'+s+'" class="modal bda-alert" style="opacity:1" data-bdalert="'+s+'">        <div class="modal-inner" style="box-shadow:0 0 8px -2px #000;">            <div class="markdown-modal">                <div class="markdown-modal-header">                    <strong style="float:left"><span>BetterDiscord - </span><span>'+e+'</span></strong>                    <span></span>                    <button class="markdown-modal-close" onclick=\'document.getElementById("bda-alert-'+s+'").remove(); utils.removeBackdrop("'+s+'");\'></button>                </div>                <div class="scroller-wrap fade">                    <div style="font-weight:700" class="scroller">'+t+'</div>                </div>                <div class="markdown-modal-footer">                    <span style="float:right"> for support.</span>                    <a style="float:right" href="https://discord.gg/0Tmfo5ZbOR9NxvDd" target="_blank">#support</a>                    <span style="float:right">Join </span>                </div>            </div>        </div>    </div>    ';$("body").append(o),utils.addBackdrop(s)};var emotesFfz={},emotesBTTV={},emotesTwitch={emotes:{emote:{image_id:0}}},subEmotesTwitch={};EmoteModule.prototype.init=function(){},EmoteModule.prototype.getBlacklist=function(){$.getJSON("https://cdn.rawgit.com/Jiiks/betterDiscordApp/"+_hash+"/data/emotefilter.json",function(e){bemotes=e.blacklist})},EmoteModule.prototype.obsCallback=function(e){var t=this;$(".emoji").each(function(){var e=$(this);-1!=e.attr("src").indexOf(".png")&&e.replaceWith(e.attr("alt"))});for(var s=0;s<e.addedNodes.length;++s){var i=e.addedNodes.item(s);if(i){var o=t.getNodes(i);for(var n in o)if(o.hasOwnProperty(n)){var a=o[n].parentElement;a&&a.classList.contains("edited")?t.injectEmote(a):t.injectEmote(o[n])}}}},EmoteModule.prototype.getNodes=function(e){for(var t,s=[],i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t=i.nextNode();)s.push(t);return s};var bemotes=[],spoilered=[];EmoteModule.prototype.injectEmote=function(e){function t(){var e=i.contents();e.each(function(t){if(void 0!=e[t]){var o=e[t].nodeValue;if(null!=o&&8!=e[t].nodeType){e.splice(t,1);var n=o.split(/([^\s]+)([\s]|$)/g).filter(function(e){return e}),a=0,r=!1,d=null;if(n.forEach(function(o,n,l){o.indexOf("[!s]")>-1&&(o=o.replace("[!s]",""),i.data("spoilered",!1),i.addClass("spoiler"));var c=["flip","spin","pulse","spin2","spin3","1spin","2spin","3spin","tr","bl","br","shake","shake2","shake3","flap"],p="",u=!1,m=o;if(o.indexOf(":")>-1){var b=o.split(":");""!=b[0]&&""!=b[1]&&(c.indexOf(b[1])>-1&&(m=b[0],p=settingsCookie["bda-es-8"]?"emote"+b[1]:""),"bttv"==b[1]&&(m=b[0],u=!0))}if(-1==$.inArray(m,bemotes)){if("undefind"!=typeof emotesTwitch&&settingsCookie["bda-es-7"]&&emotesTwitch.emotes.hasOwnProperty(m)&&m.length>=4){null!=d&&(e.splice(t+a++,0,document.createTextNode(d)),d=null);var h=twitchEmoteUrlStart+emotesTwitch.emotes[m].image_id+twitchEmoteUrlEnd;return e.splice(t+a++,0,s.createEmoteElement(m,h,p)),void(r=!0)}if("undefined"!=typeof subEmotesTwitch&&settingsCookie["bda-es-7"]&&subEmotesTwitch.hasOwnProperty(m)&&m.length>=4){null!=d&&(e.splice(t+a++,0,document.createTextNode(d)),d=null);var h=twitchEmoteUrlStart+subEmotesTwitch[m]+twitchEmoteUrlEnd;return e.splice(t+a++,0,s.createEmoteElement(m,h,p)),void(r=!0)}if("undefined"!=typeof emotesBTTV&&settingsCookie["bda-es-2"]&&emotesBTTV.hasOwnProperty(m)&&m.length>=4){null!=d&&(e.splice(t+a++,0,document.createTextNode(d)),d=null);var h=emotesBTTV[m];return e.splice(t+a++,0,s.createEmoteElement(m,h,p)),void(r=!0)}if("undefined"!=typeof emotesFfz&&settingsCookie["bda-es-1"]&&(!u||!emotesBTTV2.hasOwnProperty(m))&&emotesFfz.hasOwnProperty(m)&&m.length>=4){null!=d&&(e.splice(t+a++,0,document.createTextNode(d)),d=null);var h=ffzEmoteUrlStart+emotesFfz[m]+ffzEmoteUrlEnd;return e.splice(t+a++,0,s.createEmoteElement(m,h,p)),void(r=!0)}if("undefined"!=typeof emotesBTTV2&&settingsCookie["bda-es-2"]&&emotesBTTV2.hasOwnProperty(m)&&m.length>=4){null!=d&&(e.splice(t+a++,0,document.createTextNode(d)),d=null);var h=bttvEmoteUrlStart+emotesBTTV2[m]+bttvEmoteUrlEnd;return u&&emotesFfz.hasOwnProperty(m)&&(m+=":bttv"),e.splice(t+a++,0,s.createEmoteElement(m,h,p)),void(r=!0)}null==d?d=o:d+=""+o,n===l.length-1&&e.splice(t+a,0,document.createTextNode(d))}}),r){var l=i.outerHeight();i.html(e);var c=$(".scroller.messages").first();c.scrollTop(c.scrollTop()+(i.outerHeight()-l))}}}})}var s=this;if(e.parentElement){var i=$(e).parent();(i.hasClass("markup")||i.hasClass("message-content"))&&(t(),i.children().hasClass("edited")&&setTimeout(t,250))}},EmoteModule.prototype.createEmoteElement=function(e,t,s){var i=Math.round(e.length/4),o=e.substr(0,i)+"﷙"+e.substr(i,i)+"﷙"+e.substr(2*i,i)+"﷙"+e.substr(3*i),n='<span class="emotewrapper"><img draggable="false" style="max-height:32px;" class="emote '+s+'" alt="'+o+'" src="'+t+'"/><input onclick=\'quickEmoteMenu.favorite("'+o+'", "'+t+'");\' class="fav" title="Favorite!" type="button"></span>';return $.parseHTML(n.replace(new RegExp("﷙","g"),""))[0]},EmoteModule.prototype.autoCapitalize=function(){var e=this;$("body").delegate($(".channel-textarea-inner textarea:first"),"keyup change paste",function(){if(settingsCookie["bda-es-4"]){var t=$(".channel-textarea-inner textarea:first").val();if(void 0!=t){var s=t.split(" ").pop();if(s.length>3){if("danSgame"==s)return;var i=e.capitalize(s.toLowerCase());null!==i&&void 0!==i&&$(".channel-textarea-inner textarea:first").val(t.replace(s,i))}}}})},EmoteModule.prototype.capitalize=function(e){var t=emotesTwitch.emotes;for(var s in t)if(t.hasOwnProperty(s)&&e==(s+"").toLowerCase())return s},PublicServers.prototype.getPanel=function(){return this.container},PublicServers.prototype.init=function(){this.filtered=["134680912691462144","86004744966914048"],this.bdServer=null,this.loadingServers=!1;var e=this,t=$(".guilds>:first-child");t.after($("<div></div>",{"class":"guild",id:"bd-pub-li",css:{height:"20px",display:1==settingsCookie["bda-gs-1"]?"":"none"}}).append($("<div/>",{"class":"guild-inner",css:{height:"20px","border-radius":"4px"}}).append($("<a/>").append($("<div/>",{css:{"line-height":"20px","font-size":"12px"},text:"public",id:"bd-pub-button"}))))),$("#bd-pub-button").on("click",function(){e.show()});var s='        <div id="pubs-container">            <div id="pubs-spinner">                <span class="spinner" type="wandering-cubes">                    <span class="spinner-inner spinner-wandering-cubes">                        <span class="spinner-item"></span>                        <span class="spinner-item"></span>                    </span>                </span>            </div>            <div id="pubs-header">                <h2 id="pubs-header-title">Public Servers</h2>                <button id="pubs-searchbtn">Search</button>                <input id="pubs-sterm" type="text" placeholder="Search Term...">                <div id="pubs-select-dropdown" class="bd-dropdown">                    <button class="bd-dropdown-select" id="pubs-cat-select">All</button>                    <div class="bd-dropdown-list">                        <ul>                            <li class="pubs-cat-select-li" data-val="all">All</li>                            <li class="pubs-cat-select-li" data-val="1">FPS Games</li>                            <li class="pubs-cat-select-li" data-val="2">MMO Games</li>                            <li class="pubs-cat-select-li" data-val="3">MOBA Games</li>                            <li class="pubs-cat-select-li" data-val="4">Strategy Games</li>                            <li class="pubs-cat-select-li" data-val="5">Sports Games</li>                            <li class="pubs-cat-select-li" data-val="6">Puzzle Games</li>                            <li class="pubs-cat-select-li" data-val="7">Retro Games</li>                            <li class="pubs-cat-select-li" data-val="8">Party Games</li>                            <li class="pubs-cat-select-li" data-val="9">Tabletop Games</li>                            <li class="pubs-cat-select-li" data-val="10">Sandbox Games</li>                            <li class="pubs-cat-select-li" data-val="11">Community</li>                            <li class="pubs-cat-select-li" data-val="12">Language</li>                            <li class="pubs-cat-select-li" data-val="13">Programming</li>                            <li class="pubs-cat-select-li" data-val="14">Other</li>                            <li class="pubs-cat-select-li" data-val="15">Simulation Games</li>                        </ul>                    </div>                </div>            </div>            <div class="server-row server-pinned" style="display:none;">                <div class="server-icon" style="background-image:url(https://cdn.discordapp.comi/cons/86004744966914048/6e5729ed5c12d5af558d80d7a194c3f9.jpg)"></div>                <div class="server-info server-name"><span>BetterDiscord</span><span id="server-bd-tag">Official BetterDiscord server</span></div>                <div class="server-info server-members"><span></span></div>                <div class="server-info server-region"><span></span></div>                <div class="server-info">                    <button data-server-invite-code="0WrILkb5M80rqxl4">Join</button>                </div>            </div>            <div class="scroller-wrap">                <div class="scroller" id="pubs-scroller">                    <div id="pubs-list" class="servers-listing">                    </div>                    <div style="background:#FFF; padding: 5px 0; display:none;" id="pubs-spinner-bottom">                        <div>                            <span class="spinner" type="wandering-cubes">                                <span class="spinner-inner spinner-wandering-cubes">                                    <span class="spinner-item"></span>                                    <span class="spinner-item"></span>                                </span>                            </span>                        </div>                    </div>                </div>            </div>            <div id="pubs-footer">                <span style="color:#FFF; font-size:10px; font-weight:700; margin-left:5px;">Tip: Hover over server name for description if available</span>                <div>Server list provided by <a href="https://discordservers.com" target="_blank">DiscordServers.com</a></div>            </div>        ';this.container=s,$("#bd-pub-li").length<1&&setTimeout(function(){e.init()},250)},PublicServers.prototype.getPinnedServer=function(){var e=this,t={sort:[{online:"desc"}],size:1,query:{query_string:{default_operator:"AND",query:"BetterDiscord"}}};$.ajax({type:"POST",dataType:"json",url:"https://search-discordservers-izrtub5nprzrl76ugyy6hdooe4.us-west-1.es.amazonaws.com/discord_servers/_search",crossDomain:!0,data:JSON.stringify(t),success:function(t){try{var s=t.hits.hits[0]._source;"86004744966914048"==s.identifier&&(e.bdServer=s,e.showPinnedServer())}catch(i){e.bdServer=null}}})},PublicServers.prototype.hidePinnedServer=function(){$("#pubs-container .scroller-wrap").css({"margin-top":"0",height:"500px"}),$(".server-pinned").hide()},PublicServers.prototype.showPinnedServer=function(){$(".server-pinned .server-icon").css("background-image","url("+this.bdServer.icon+")"),$(".server-pinned .server-members span").text(this.bdServer.online+"/"+this.bdServer.members+" Members"),$(".server-pinned .server-region span").text(this.bdServer.region),$(".server-pinned .server-info button").data("server-invite-code",this.bdServer.invite_code),$("#pubs-container .scroller-wrap").css({"margin-top":"75px",height:"425px"}),$(".server-pinned").show()},PublicServers.prototype.show=function(){var e=this;this.hidePinnedServer(),$("#pubs-cat-select").text("All"),this.selectedCategory="all",$("#pubs-container .scroller-wrap").css({"margin-top":"0",height:"500px"}),$(".server-pinned").hide(),$(".app").append(this.getPanel()),null==this.bdServer?this.getPinnedServer():this.showPinnedServer(),e.search(0,!0),$("#pubs-searchbtn").off("click").on("click",function(){e.search()}),$("#pubs-sterm").off("keyup").on("keyup",function(t){13==t.keyCode&&e.search(0,!0)}),$("#pubs-cat-select").off("click").on("click",function(){$("#pubs-select-dropdown").addClass("open")}),$(".pubs-cat-select-li").off("click").on("click",function(){$("#pubs-select-dropdown").removeClass("open"),$("#pubs-cat-select").text($(this).text()),e.selectedCategory!=$(this).data("val")&&(e.selectedCategory=$(this).data("val"),e.search(0,!0))}),$("#pubs-container").off("mouseup").on("mouseup",function(){$("#pubs-select-dropdown").removeClass("open")});var e=this;$(document).on("mouseup.bdps",function(t){$("#bd-pub-button").is(t.target)||$("#pubs-container").is(t.target)||0!==$("#pubs-container").has(t.target).length||e.hide()}),$("#pubs-scroller").off("scroll.pubs").on("scroll.pubs",function(){if(!e.loadingServers){var t=$("#pubs-list");$(this).scrollTop()+550<t.height()||t.children().length%20==0&&(e.loadingServers=!0,$("#pubs-spinner-bottom").show(),e.search(t.children().length,!1))}})},PublicServers.prototype.hide=function(){$("#pubs-container").remove(),$(document).off("mouseup.bdps")},PublicServers.prototype.loadServers=function(e,t,s){this.loadingServers=!0;var i=this;$("#pubs-searchbtn").prop("disabled",!0),$("#pubs-sterm").prop("disabled",!0),s&&$("#pubs-list").empty(),$("#pubs-spinner").show(),$.ajax({type:"POST",dataType:"json",url:"https://search-discordservers-izrtub5nprzrl76ugyy6hdooe4.us-west-1.es.amazonaws.com/discord_servers/_search",crossDomain:!0,data:JSON.stringify(e),success:function(e){var s=e.hits.hits;t?$("#pubs-header-title").text("Public Servers - Search Results: "+s.length):$("#pubs-header-title").text("Public Servers"),s.forEach(function(e){var t=e._source,s=t.invite_code.replace(/ /g,""),o='<div class="server-row">';o+='<div class="server-icon" style="background-image:url('+t.icon+')"></div>',o+='<div class="server-info server-name">',o+='<div class="server-information">',t.is_official&&(o+='<span class="server-official">Official!</span>'),o+='<span class="server-name-span">'+t.name+"</span>";var n=[];t.categories.forEach(function(e){n.push(e.name)}),o+='<span class="server-tags">'+n.join(", ")+"</span>",o+='<span class="server-description">'+(void 0==t.description?"No Description":t.description)+"</span>",o+="</div>",o+="</div>",o+='<div class="server-info server-members">',o+="<span>"+t.online+"/"+t.members+" Members</span>",o+="</div>",o+='<div class="server-info server-region">',o+="<span>"+t.region+"</span>",o+="</div>",o+='<div class="server-info">',o+="<button data-server-invite-code="+s+">Join</button>",o+="</div>",o+="</div>",$("#pubs-list").append(o),$("button[data-server-invite-code="+s+"]").on("click",function(){i.joinServer(s)})}),t&&$("#pubs-header-title").text("Public Servers - Search Results: "+$("#pubs-list").children().length)},done:function(){$("#pubs-spinner").hide(),$("#pubs-spinner-bottom").hide(),$("#pubs-searchbtn").prop("disabled",!1),$("#pubs-sterm").prop("disabled",!1),i.loadingServers=!1},always:function(){$("#pubs-spinner").hide(),$("#pubs-spinner-bottom").hide(),$("#pubs-searchbtn").prop("disabled",!1),$("#pubs-sterm").prop("disabled",!1),i.loadingServers=!1},error:function(){$("#pubs-spinner").hide(),$("#pubs-spinner-bottom").hide(),$("#pubs-searchbtn").prop("disabled",!1),$("#pubs-sterm").prop("disabled",!1),i.loadingServers=!1},complete:function(){$("#pubs-spinner").hide(),$("#pubs-spinner-bottom").hide(),$("#pubs-searchbtn").prop("disabled",!1),$("#pubs-sterm").prop("disabled",!1),i.loadingServers=!1}})},PublicServers.prototype.search=function(e,t){var s=$("#pubs-sterm").val(),i={sort:[{online:"desc"}],from:e,size:20,query:{filtered:{query:{query_string:{default_operator:"AND",query:s?s:"*"}},filter:{bool:{must_not:[{terms:{identifier:this.filtered}}]}}}}};"all"!=this.selectedCategory&&(i.query.filtered.filter.bool.must=[{term:{"categories.id":this.selectedCategory}}]),this.loadServers(i,!0,t)},PublicServers.prototype.joinServer=function(e){$(".guilds-add").click(),$(".action.join .btn").click(),$(".create-guild-container input").val(e),$(".form.join-server .btn-primary").click()},QuickEmoteMenu.prototype.init=function(){$(document).on("mousedown",function(e){"rmenu"!=e.target.id&&$("#rmenu").remove()}),this.favoriteEmotes={};var e=localStorage.bdfavemotes;void 0!=e&&(this.favoriteEmotes=JSON.parse(atob(e)));var t="";t+='<div id="bda-qem">',t+='    <button class="active" id="bda-qem-twitch" onclick=\'quickEmoteMenu.switchHandler(this); return false;\'>Twitch</button>',t+="    <button id=\"bda-qem-favourite\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Favourite</button>",t+="    <button id=\"bda-qem-emojis\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Emojis</buttond>",t+="</div>",this.qmeHeader=t;var s="";s+='<div id="bda-qem-twitch-container">',s+='    <div class="scroller-wrap fade">',s+='        <div class="scroller">',s+='            <div class="emote-menu-inner">';for(var i in emotesTwitch.emotes)if(emotesTwitch.emotes.hasOwnProperty(i)){var o=emotesTwitch.emotes[i].image_id;s+='<div class="emote-container">',s+='    <img class="emote-icon" id="'+i+'" alt="" src="https://static-cdn.jtvnw.net/emoticons/v1/'+o+'/1.0" title="'+i+'">',s+="    </img>",s+="</div>"}s+="            </div>",s+="        </div>",s+="    </div>",s+="</div>",this.teContainer=s;var n="";n+='<div id="bda-qem-favourite-container">',n+='    <div class="scroller-wrap fade">',n+='        <div class="scroller">',n+='            <div class="emote-menu-inner">';for(var i in this.favoriteEmotes){var a=this.favoriteEmotes[i];n+='<div class="emote-container">',n+='    <img class="emote-icon" alt="" src="'+a+'" title="'+i+"\" oncontextmenu='quickEmoteMenu.favContext(event, this);'>",n+="    </img>",n+="</div>"}n+="            </div>",n+="        </div>",n+="    </div>",n+="</div>",this.faContainer=n},QuickEmoteMenu.prototype.favContext=function(e,t){e.stopPropagation();var s=$("<div/>",{id:"rmenu","data-emoteid":$(t).prop("title"),text:"Remove"});return s.css({top:e.pageY-$("#bda-qem-favourite-container").offset().top,left:e.pageX-$("#bda-qem-favourite-container").offset().left}),$(t).parent().append(s),s.on("click",function(e){return e.preventDefault(),e.stopPropagation(),$(this).remove(),delete quickEmoteMenu.favoriteEmotes[$(this).data("emoteid")],quickEmoteMenu.updateFavorites(),!1}),!1},QuickEmoteMenu.prototype.switchHandler=function(e){this.switchQem($(e).attr("id"))},QuickEmoteMenu.prototype.switchQem=function(e){var t=$("#bda-qem-twitch"),s=$("#bda-qem-favourite"),i=$("#bda-qem-emojis");switch(t.removeClass("active"),s.removeClass("active"),i.removeClass("active"),$(".emoji-picker").hide(),$("#bda-qem-favourite-container").hide(),$("#bda-qem-twitch-container").hide(),e){case"bda-qem-twitch":t.addClass("active"),$("#bda-qem-twitch-container").show();break;case"bda-qem-favourite":s.addClass("active"),$("#bda-qem-favourite-container").show();break;case"bda-qem-emojis":i.addClass("active"),$(".emoji-picker").show()}this.lastTab=e;var o=$(".emote-icon");o.off(),o.on("click",function(){var e=$(this).attr("title"),t=$(".channel-textarea-inner textarea");t.val(" "==t.val().slice(-1)?t.val()+e:t.val()+" "+e)})},QuickEmoteMenu.prototype.obsCallback=function(e){if(settingsCookie["bda-es-9"]?e.removeClass("bda-qme-hidden"):e.addClass("bda-qme-hidden"),settingsCookie["bda-es-0"]){e.prepend(this.qmeHeader),e.append(this.teContainer),e.append(this.faContainer),void 0==this.lastTab&&(this.lastTab="bda-qem-favourite"),this.switchQem(this.lastTab)}},QuickEmoteMenu.prototype.favorite=function(e,t){this.favoriteEmotes.hasOwnProperty(e)||(this.favoriteEmotes[e]=t),this.updateFavorites()},QuickEmoteMenu.prototype.updateFavorites=function(){var e="";e+='<div id="bda-qem-favourite-container">',e+='    <div class="scroller-wrap fade">',e+='        <div class="scroller">',e+='            <div class="emote-menu-inner">';for(var t in this.favoriteEmotes){var s=this.favoriteEmotes[t];e+='<div class="emote-container">',e+='    <img class="emote-icon" alt="" src="'+s+'" title="'+t+"\" oncontextmenu='quickEmoteMenu.favContext(event, this);'>",e+="    </img>",e+="</div>"}e+="            </div>",e+="        </div>",e+="    </div>",e+="</div>",this.faContainer=e,$("#bda-qem-favourite-container").replaceWith(e),window.localStorage.bdfavemotes=btoa(JSON.stringify(this.favoriteEmotes))},CustomCssEditor.prototype.init=function(){var e=this;e.hideBackdrop=!1,e.editor=CodeMirror.fromTextArea(document.getElementById("bd-custom-css-ta"),{lineNumbers:!0,mode:"css",indentUnit:4,theme:"neat"}),e.editor.on("change",function(t){var s=t.getValue();e.applyCustomCss(s,!1,!1)});var t="";t+='<div id="bd-customcss-attach-controls">',t+='       <ul class="checkbox-group">',
t+="       <li>",t+='           <div class="checkbox" onclick="settingsPanel.updateSetting(this);">',t+='               <div class="checkbox-inner"><input id="bda-css-0" type="checkbox" '+(settingsCookie["bda-css-0"]?"checked":"")+"><span></span></div>",t+='               <span title="Update client css while typing">Live Update</span>',t+="           </div>",t+="       </li>",t+="       <li>",t+='           <div class="checkbox" onclick="settingsPanel.updateSetting(this);">',t+='               <div class="checkbox-inner"><input id="bda-css-1" type="checkbox" '+(settingsCookie["bda-css-1"]?"checked":"")+"><span></span></div>",t+='               <span title="Autosave css to localstorage when typing">Autosave</span>',t+="           </div>",t+="       </li>",t+="        <li>",t+='           <div class="checkbox" onclick="settingsPanel.updateSetting(this);">',t+='               <div class="checkbox-inner"><input id="bda-css-2" type="checkbox" '+(customCssEditor.hideBackdrop?"checked":"")+"><span></span></div>",t+='               <span title="Hide the callout backdrop to disable modal close events">Hide Backdrop</span>',t+="           </div>",t+="       </li>",t+="   </ul>",t+='   <div id="bd-customcss-detach-controls-buttons">',t+='       <button class="btn btn-primary" id="bd-customcss-detached-update" onclick="return false;">Update</button>',t+='       <button class="btn btn-primary" id="bd-customcss-detached-save"  onclick="return false;">Save</button>',t+='       <button class="btn btn-primary" id="bd-customcss-detached-detach" onclick="customCssEditor.detach(); return false;">Detach</button>',t+="   </div>",t+="</div>",this.attachEditor=t,$("#bd-customcss-innerpane").append(t),$("#bd-customcss-detached-update").on("click",function(){return e.applyCustomCss(e.editor.getValue(),!0,!1),!1}),$("#bd-customcss-detached-save").on("click",function(){return e.applyCustomCss(e.editor.getValue(),!1,!0),!1});var s="";s+='<div id="bd-customcss-detach-container">',s+='   <div id="bd-customcss-detach-editor">',s+="   </div>",s+="</div>",this.detachedEditor=s},CustomCssEditor.prototype.attach=function(){$("#editor-detached").hide(),$("#app-mount").removeClass("bd-detached-editor"),$("#bd-customcss-pane").append($("#bd-customcss-innerpane")),$("#bd-customcss-detached-detach").show(),$("#bd-customcss-detach-container").remove()},CustomCssEditor.prototype.detach=function(){this.attach(),$("#editor-detached").show(),$("#bd-customcss-detached-detach").hide(),$("#app-mount").addClass("bd-detached-editor"),$(".app").parent().append(this.detachedEditor),$("#bd-customcss-detach-editor").append($("#bd-customcss-innerpane"))},CustomCssEditor.prototype.applyCustomCss=function(e,t,s){0==$("#customcss").length&&$("head").append('<style id="customcss"></style>'),(t||settingsCookie["bda-css-0"])&&$("#customcss").html(e),(s||settingsCookie["bda-css-1"])&&localStorage.setItem("bdcustomcss",btoa(e))};var settingsButton=null,panel=null;SettingsPanel.prototype.init=function(){var e=this;e.construct();var t=$("body");settingsCookie["bda-es-0"]?$("#twitchcord-button-container").show():$("#twitchcord-button-container").hide(),settingsCookie["bda-gs-2"]?t.addClass("bd-minimal"):t.removeClass("bd-minimal"),settingsCookie["bda-gs-3"]?t.addClass("bd-minimal-chan"):t.removeClass("bd-minimal-chan"),settingsCookie["bda-gs-4"]&&voiceMode.enable(),settingsCookie["bda-gs-5"]&&$("#app-mount").addClass("bda-dark"),settingsCookie["bda-es-6"]?(emoteNamePopup=$("<div class='tipsy tipsy-se' style='display: block; top: 82px; left: 1630.5px; visibility: visible; opacity: 0.8;'><div class='tipsy-inner'></div></div>"),$(document).on("mouseover",".emote",function(){var e=$(this).offset(),t=$(this).attr("alt");$(emoteNamePopup).find(".tipsy-inner").text(t),$(emoteNamePopup).css("left",e.left-25),$(emoteNamePopup).css("top",e.top-37),$(".app").append($(emoteNamePopup))}),$(document).on("mouseleave",".emote",function(){$(".tipsy").remove()})):$(document).off("mouseover",".emote")};var customCssInitialized=!1,lastTab="";SettingsPanel.prototype.changeTab=function(e){lastTab=e;$("#bd-control-groups");switch($(".bd-tab").removeClass("selected"),$(".bd-pane").hide(),$("#"+e).addClass("selected"),$("#"+e.replace("tab","pane")).show(),e){case"bd-settings-tab":$(".bda-slist-top").show();break;case"bd-emotes-tab":$(".bda-slist-top").show();break;case"bd-customcss-tab":$(".bda-slist-top").show(),customCssInitialized||(customCssEditor.init(),customCssInitialized=!0);break;case"bd-themes-tab":$(".bda-slist-top:first").hide();break;case"bd-plugins-tab":$(".bda-slist-top:first").hide();break;default:$(".bda-slist-top").show()}},SettingsPanel.prototype.updateSetting=function(e){var t=$(e).children().find('input[type="checkbox"]'),s=!t.is(":checked"),i=t.attr("id");t.prop("checked",s),"bda-css-2"==i&&($("#app-mount").removeClass("bd-hide-bd"),customCssEditor.hideBackdrop=s,s&&$("#app-mount").addClass("bd-hide-bd")),settingsCookie[i]=s,this.updateSettings()},SettingsPanel.prototype.updateSettings=function(){settingsCookie["bda-es-0"]?$("#twitchcord-button-container").show():$("#twitchcord-button-container").hide(),settingsCookie["bda-gs-2"]?$("body").addClass("bd-minimal"):$("body").removeClass("bd-minimal"),settingsCookie["bda-gs-3"]?$("body").addClass("bd-minimal-chan"):$("body").removeClass("bd-minimal-chan"),settingsCookie["bda-gs-1"]?$("#bd-pub-li").show():$("#bd-pub-li").hide(),settingsCookie["bda-gs-4"]?voiceMode.enable():voiceMode.disable(),$("#app-mount").removeClass("bda-dark"),settingsCookie["bda-gs-5"]&&$("#app-mount").addClass("bda-dark"),settingsCookie["bda-es-6"]?(emoteNamePopup=$("<div class='tipsy tipsy-se' style='display: block; top: 82px; left: 1630.5px; visibility: visible; opacity: 0.8;'><div class='tipsy-inner'></div></div>"),$(document).on("mouseover",".emote",function(){var e=$(this).offset(),t=$(this).attr("alt");$(emoteNamePopup).find(".tipsy-inner").text(t),$(emoteNamePopup).css("left",e.left-25),$(emoteNamePopup).css("top",e.top-32),$("div[data-reactid='.0.1.1']").append($(emoteNamePopup))}),$(document).on("mouseleave",".emote",function(){$(".tipsy").remove()})):$(document).off("mouseover",".emote"),mainCore.saveSettings()},SettingsPanel.prototype.construct=function(){function e(){$(".tab-bar-item").removeClass("selected"),settingsButton.addClass("selected"),$(".form .settings-right .settings-inner").first().hide(),panel.show(),""==lastTab?t.changeTab("bd-settings-tab"):t.changeTab(lastTab)}var t=this;panel=$("<div/>",{id:"bd-pane","class":"settings-inner",css:{display:"none"}});var s='        <div class="scroller-wrap">            <div class="scroller settings-wrapper settings-panel">            <div class="tab-bar TOP">                <div class="tab-bar-item bd-tab" id="bd-settings-tab" onclick=\'settingsPanel.changeTab("bd-settings-tab");\'>Core                </div>                <div class="tab-bar-item bd-tab" id="bd-emotes-tab" onclick=\'settingsPanel.changeTab("bd-emotes-tab");\'>Emotes                </div>                <div class="tab-bar-item bd-tab" id="bd-customcss-tab" onclick=\'settingsPanel.changeTab("bd-customcss-tab");\'>Custom CSS                </div>                <div class="tab-bar-item bd-tab" id="bd-plugins-tab" onclick=\'settingsPanel.changeTab("bd-plugins-tab");\'>Plugins                </div>                <div class="tab-bar-item bd-tab" id="bd-themes-tab" onclick=\'settingsPanel.changeTab("bd-themes-tab");\'>Themes                </div>                <div class="bda-slist-top">                    <button class="btn btn-primary" onclick="utils.exportSettings(); return false;">Export</button>                    <button class="btn btn-primary" onclick="utils.importSettings(); return false;">Import</button>                </div>            </div>            <div class="bd-settings">                <div class="bd-pane control-group" id="bd-settings-pane" style="display:none;">                    <ul class="checkbox-group">    ';for(var i in settings){var o=settings[i],n=o.id;"core"==o.cat&&o.implemented&&!o.hidden&&(s+='            <li>                <div class="checkbox" onclick="settingsPanel.updateSetting(this);">                    <div class="checkbox-inner">                        <input type="checkbox" id="'+n+'" '+(settingsCookie[n]?"checked":"")+">                        <span></span>                    </div>                    <span>                        "+i+" - "+o.info+"                    </span>                </div>            </li>        ")}s+="                    </ul>                </div>    ",s+='        <div class="bd-pane control-group" id="bd-emotes-pane" style="display:none;">            <ul class="checkbox-group">    ';for(var i in settings){var o=settings[i],n=o.id;"emote"==o.cat&&o.implemented&&!o.hidden&&(s+='            <li>                <div class="checkbox" onclick="settingsPanel.updateSetting(this);">                    <div class="checkbox-inner">                        <input type="checkbox" id="'+n+'" '+(settingsCookie[n]?"checked":"")+">                        <span></span>                    </div>                    <span>                        "+i+" - "+o.info+"                    </span>                </div>            </li>        ")}s+="            </ul>        </div>    ";var a=atob(localStorage.getItem("bdcustomcss"));customCssEditor.applyCustomCss(a,!0,!1),s+='        <div class="bd-pane control-group" id="bd-customcss-pane" style="display:none;">            <div id="editor-detached" style="display:none;">                <h3>Editor Detached</h3>                <button class="btn btn-primary" onclick="customCssEditor.attach(); return false;">Attach</button>            </div>            <div id="bd-customcss-innerpane">                <textarea id="bd-custom-css-ta">'+a+"</textarea>            </div>        </div>    ",s+='        <div class="bd-pane control-group" id="bd-plugins-pane" style="display:show;">            <div class="bda-slist-top">                <button class="btn btn-primary" onclick=\'betterDiscordIPC.send("asynchronous-message", { "arg": "opendir", "path": "plugindir" }); return false;\'>Open Plugin Folder</button>                <button class="btn btn-primary" onclick=\'window.open("https://betterdiscord.net/plugins"); return false;\'>Get Plugins</button>            </div>            <ul class="bda-slist">    ',$.each(bdplugins,function(){var e=this.plugin,t=!1;"function"==typeof e.getSettingsPanel&&(t=null!=e.getSettingsPanel()&&""!=e.getSettingsPanel()),s+='            <li>                <div class="bda-left">                    <span class="bda-name">'+e.getName()+" v"+e.getVersion()+" by "+e.getAuthor()+'</span>                    <div class="scroller-wrap fade">                        <div class="scroller bda-description">'+e.getDescription()+'</div>                    </div>                </div>                <div class="bda-right">                    <div class="checkbox" onclick="pluginModule.handlePlugin(this);">                        <div class="checkbox-inner">                            <input id="'+e.getName().replace(" ","__")+'" type="checkbox" '+(pluginCookie[e.getName()]?"checked":"")+'>                            <span></span>                        </div>                        <span></span>                    </div>                    <button class="btn btn-primary bda-plugin-reload" onclick="return false;" disabled>Reload</button>                    <button class="btn btn-primary bda-plugin-settings" onclick=\'pluginModule.showSettings("'+e.getName()+"\"); return false;' "+(t?"":"disabled")+">Settings</button>                </div>            </li>        "}),s+="            </ul>        </div>    ",s+='        <div class="bd-pane control-group" id="bd-themes-pane" style="display:none;">            <div class="bda-slist-top">                <button class="btn btn-primary" onclick=\'betterDiscordIPC.send("asynchronous-message", { "arg": "opendir", "path": "themedir" }); return false;\'>Open Theme Folder</button>                <button class="btn btn-primary" onclick=\'window.open("https://betterdiscord.net/themes"); return false;\'>Get Themes</button>            </div>            <ul class="bda-slist">    ',"undefined"==typeof themesupport2?s+="Your version does not support themes!":$.each(bdthemes,function(){s+='            <li>                <div class="bda-left">                    <span class="bda-name">'+this.name.replace(/_/g," ")+" v"+this.version+" by "+this.author+'</span>                    <div class="scroller-wrap fade">                        <div class="scroller bda-description">'+this.description+'</div>                    </div>                </div>                <div class="bda-right">                    <div class="checkbox" onclick="themeModule.handleTheme(this);">                        <div class="checkbox-inner">                            <input id="ti'+this.name+'" type="checkbox" '+(themeCookie[this.name]?"checked":"")+'>                            <span></span>                        </div>                        <span></span>                    </div>                    <button class="btn btn-primary bda-plugin-reload" onclick="return false;" disabled>Reload</button>                </div>            </li>        '}),s+="            </ul>        </div>    ",s+='        <div style="background:#2E3136; color:#ADADAD; height:30px; position:absolute; bottom:0; left:0; right:0;">            <span style="line-height:30px;margin-left:10px;">BetterDiscord v'+("undefined"==typeof version?bdVersion:version)+"(JSv"+jsVersion+') by Jiiks</span>            <span style="float:right;line-height:30px;margin-right:10px;"><a href="http://betterdiscord.net" target="_blank">BetterDiscord.net</a></span>            <span id="bd-changelog" onclick=\'$("body").append(mainCore.constructChangelog());\'>changelog</span>        </div>        </div></div>    ',settingsButton=$("<div/>",{"class":"tab-bar-item",text:"BetterDiscord",id:"bd-settings-new",click:e}),panel.html(s),this.panel=panel},SettingsPanel.prototype.inject=function(e){if("childList"==e.type&&!(e.addedNodes.length<=0||$(e.addedNodes[0]).find(".user-settings-modal").length<=0)){var t=this;this.panel.hide();var s=$(".tab-bar.SIDE").first();$(".tab-bar.SIDE .tab-bar-item").click(function(){$(".form .settings-right .settings-inner").first().show(),$("#bd-settings-new").removeClass("selected"),t.panel.hide()}),s.append(settingsButton),$(".form .settings-right .settings-inner").last().after(t.panel),$("#bd-settings-new").removeClass("selected")}};var _hash;Utils.prototype.getTextArea=function(){return $(".channel-textarea-inner textarea")},Utils.prototype.jqDefer=function(e){window.jQuery?e():setTimeout(function(){this.jqDefer(e)},100)},Utils.prototype.getHash=function(){$.getJSON("https://api.github.com/repos/Jiiks/BetterDiscordApp/commits/master",function(e){_hash=e.sha,emoteModule.getBlacklist()})},Utils.prototype.loadHtml=function(e,t){var s=$("<div/>",{"class":"bd-container"}).appendTo("body");e="//cdn.rawgit.com/Jiiks/BetterDiscordApp/"+_hash+"/html/"+e+".html",s.load(e,t())},Utils.prototype.injectJs=function(e){$("<script/>",{type:"text/javascript",src:e}).appendTo($("body"))},Utils.prototype.injectCss=function(e){$("<link/>",{type:"text/css",rel:"stylesheet",href:e}).appendTo($("head"))},Utils.prototype.log=function(e){console.log("%c[%cBetterDiscord%c] %c"+e,"color: red;","color: #303030; font-weight:700;","color:red;","")},Utils.prototype.err=function(e){console.log("%c[%cBetterDiscord%c] %c"+e,"color: red;","color: red; font-weight:700;","color:red;","")},Utils.prototype.importSettings=function(){mainCore.alert("Import Settings",'<div class="form" style="width:100%;"><div class="control-group"><textarea id="bda-import-textarea" style="min-height:150px;"></textarea></div><button id="bda-import-settings" class="btn btn-primary">Import</button></div>'),$("#bda-import-settings").off("click").on("click",function(){var e;try{e=JSON.parse($("#bda-import-textarea").val())}catch(t){return mainCore.alert("Invalid Data",t),!1}try{for(key in e.settings){var s=e.settings[key];if(settingsCookie.hasOwnProperty(key)){settingsCookie[key]=s;var i=$("#"+key);i.prop("checked",s),settingsPanel.updateSettings()}}localStorage.bdcustomcss=e.customCss;var o=atob(localStorage.getItem("bdcustomcss"));customCssInitialized||(customCssEditor.init(),customCssInitialized=!0),customCssEditor.applyCustomCss(o,settingsCookie["bda-css-0"],!1),customCssEditor.editor.setValue(o)}catch(t){return mainCore.alert("Invalid Data",t),!1}try{$.each(e.plugins,function(t){var s=e.plugins[t];if(bdplugins.hasOwnProperty(t)){pluginCookie[t]=s;var i=$("#"+t.replace(" ","__"));i.is(":checked")&&!s&&(bdplugins[t].plugin.stop(),i.prop("checked",!1)),!i.is(":checked")&&s&&(bdplugins[t].plugin.start(),i.prop("checked",!0))}}),pluginModule.savePluginData()}catch(t){return mainCore.alert("Failed to load plugin data",t),!1}try{themeCookie=e.themes,$.each(themeCookie,function(e){var t=themeCookie[e],s="#ti"+e;bdthemes.hasOwnProperty(e)&&($(s).is(":checked")&&!t&&($(s).prop("checked",!1),$("#"+e).remove()),!$(s).is(":checked")&&t&&($(s).prop("checked",!0),$("head").append('<style id="'+e+'">'+unescape(bdthemes[e].css)+"</style>")))}),themeModule.saveThemeData()}catch(t){return mainCore.alert("Failed to load theme data",t),!1}return!1})},Utils.prototype.exportSettings=function(){var e={settings:settingsCookie,customCss:localStorage.bdcustomcss,plugins:pluginCookie,themes:themeCookie,favEmotes:window.localStorage.bdfavemotes};mainCore.alert("Export Settings",'<div class="form" style="width:100%;"><div class="control-group"><textarea style="min-height:150px;">'+JSON.stringify(e)+"</textarea></div></div>")},Utils.prototype.addBackdrop=function(e){var t=$("<div/>",{"class":"bda-backdrop","data-bdbackdrop":e,mouseup:function(){$('[data-bdalert="'+e+'"]').remove(),$(this).remove()}});$("#app-mount").append(t)},Utils.prototype.removeBackdrop=function(e){$('[data-bdbackdrop="'+e+'"]').remove()},VoiceMode.prototype.obsCallback=function(){var e=this;settingsCookie["bda-gs-4"]&&(e.disable(),setTimeout(function(){e.enable()},300))},VoiceMode.prototype.enable=function(){$(".scroller.guild-channels ul").first().css("display","none"),$(".scroller.guild-channels header").first().css("display","none"),$(".app.flex-vertical").first().css("overflow","hidden"),$(".chat.flex-vertical.flex-spacer").first().css("visibility","hidden").css("min-width","0px"),$(".flex-vertical.channels-wrap").first().css("flex-grow","100000"),$(".guild-header .btn.btn-hamburger").first().css("visibility","hidden")},VoiceMode.prototype.disable=function(){$(".scroller.guild-channels ul").first().css("display",""),$(".scroller.guild-channels header").first().css("display",""),$(".app.flex-vertical").first().css("overflow",""),$(".chat.flex-vertical.flex-spacer").first().css("visibility","").css("min-width",""),$(".flex-vertical.channels-wrap").first().css("flex-grow",""),$(".guild-header .btn.btn-hamburger").first().css("visibility","")};var pluginCookie={};PluginModule.prototype.loadPlugins=function(){this.loadPluginData(),$.each(bdplugins,function(){var e=this.plugin;e.load();var t=e.getName(),s=!1;pluginCookie.hasOwnProperty(t)?s=pluginCookie[t]:pluginCookie[t]=!1,s&&e.start()})},PluginModule.prototype.handlePlugin=function(e){var t=$(e).children().find('input[type="checkbox"]'),s=!t.is(":checked"),i=t.attr("id").replace("__"," ");t.prop("checked",s),s?(bdplugins[i].plugin.start(),pluginCookie[i]=!0):(bdplugins[i].plugin.stop(),pluginCookie[i]=!1),this.savePluginData()},PluginModule.prototype.showSettings=function(e){if(null!=bdplugins[e]&&"function"==typeof bdplugins[e].plugin.getSettingsPanel){var t=bdplugins[e].plugin.getSettingsPanel();$(".modal-inner").off("click.bdpsm").on("click.bdpsm",function(e){$("#bd-psm-id").length?$(".bd-psm").remove():$(".bd-psm").attr("id","bd-psm-id")}),$(".modal").append('<div class="bd-psm"><div class="scroller-wrap" style="height:100%"><div id="bd-psm-s" class="scroller" style="padding:10px;"></div></div></div>'),$("#bd-psm-s").append(t)}},PluginModule.prototype.loadPluginData=function(){var e=$.cookie("bd-plugins");void 0!=e&&(pluginCookie=JSON.parse($.cookie("bd-plugins")))},PluginModule.prototype.savePluginData=function(){$.cookie("bd-plugins",JSON.stringify(pluginCookie),{expires:365,path:"/"})},PluginModule.prototype.newMessage=function(){$.each(bdplugins,function(){pluginCookie[this.plugin.getName()]&&"function"==typeof this.plugin.onMessage&&this.plugin.onMessage()})},PluginModule.prototype.channelSwitch=function(){$.each(bdplugins,function(){pluginCookie[this.plugin.getName()]&&"function"==typeof this.plugin.onSwitch&&this.plugin.onSwitch()})},PluginModule.prototype.socketEvent=function(e,t){$.each(bdplugins,function(){pluginCookie[this.plugin.getName()]&&"function"==typeof this.plugin.socketEvent&&this.plugin.socketEvent(t)})},PluginModule.prototype.rawObserver=function(e){$.each(bdplugins,function(){pluginCookie[this.plugin.getName()]&&"function"==typeof this.plugin.observer&&this.plugin.observer(e)})};var themeCookie={};ThemeModule.prototype.loadThemes=function(){this.loadThemeData(),$.each(bdthemes,function(){var e=this.name,t=!1;themeCookie.hasOwnProperty(e)?themeCookie[e]&&(t=!0):themeCookie[e]=!1,t&&$("head").append('<style id="'+e+'">'+unescape(bdthemes[e].css)+"</style>")})},ThemeModule.prototype.handleTheme=function(e){var t=$(e).children().find('input[type="checkbox"]'),s=!t.is(":checked"),i=t.attr("id").substring(2);t.prop("checked",s),s?($("head").append('<style id="'+i+'">'+unescape(bdthemes[i].css)+"</style>"),themeCookie[i]=!0):($("#"+i).remove(),themeCookie[i]=!1),this.saveThemeData()},ThemeModule.prototype.loadThemeData=function(){var e=$.cookie("bd-themes");void 0!=e&&(themeCookie=JSON.parse($.cookie("bd-themes")))},ThemeModule.prototype.saveThemeData=function(){$.cookie("bd-themes",JSON.stringify(themeCookie),{expires:365,path:"/"})};var bdSocket,bdws;BdWSocket.prototype.start=function(){},BdWSocket.prototype.open=function(e){utils.log("Socket Host: "+e);try{bdSocket=new WebSocket(e),bdSocket.onopen=this.onOpen,bdSocket.onmessage=this.onMessage,bdSocket.onerror=this.onError,bdSocket.onclose=this.onClose}catch(t){utils.log(t)}},BdWSocket.prototype.onOpen=function(){utils.log("Socket Open");var e={op:2,d:{token:JSON.parse(localStorage.getItem("token")),properties:JSON.parse(localStorage.getItem("superProperties")),v:3}};bdws.send(e)},BdWSocket.prototype.onMessage=function(e){var t,s,i;try{t=JSON.parse(e.data),s=t.d,i=t.t}catch(o){return void utils.err(o)}switch(i){case"READY":bdSocket.interval=setInterval(function(){bdws.send({op:1,d:Date.now()})},s.heartbeat_interval),utils.log("Socket Ready");break;case"PRESENCE_UPDATE":pluginModule.socketEvent("PRESENCE_UPDATE",s);break;case"TYPING_START":pluginModule.socketEvent("TYPING_START",s);break;case"MESSAGE_CREATE":pluginModule.socketEvent("MESSAGE_CREATE",s);break;case"MESSAGE_UPDATE":pluginModule.socketEvent("MESSAGE_UPDATE",s)}},BdWSocket.prototype.onError=function(e){utils.log("Socket Error - "+e.message)},BdWSocket.prototype.onClose=function(e){utils.log("Socket Closed - "+e.code+" : "+e.reason),clearInterval(bdSocket.interval),bdws.start()},BdWSocket.prototype.send=function(e){1==bdSocket.readyState&&bdSocket.send(JSON.stringify(e))},BdWSocket.prototype.getSocket=function(){return bdSocket},BdApi.joinServer=function(e){opublicServers.joinServer(e)},BdApi.injectCSS=function(e,t){$("head").append('<style id="'+e+'"></style>'),$("#"+e).html(t)},BdApi.clearCSS=function(e){$("#"+e).remove()},BdApi.getPlugin=function(e){return bdplugins.hasOwnProperty(e)?bdplugins[e].plugin:null},BdApi.getIpc=function(){return betterDiscordIPC},BdApi.getCore=function(){return mainCore},BdApi.getUserIdByName=function(e){for(var t=$(".member-username"),s=0;s<t.length;s++){var i=$(t[s]);if(i.text()==e){var o=i.closest(".member").find(".avatar-small").css("background-image");return o.match(/\d+/)}}return null};var gg;BdApi.getUserNameById=function(e){for(var t=$(".avatar-small"),s=0;s<t.length;s++){var i=$(t[s]),o=i.css("background-image");if(e==o.match(/\d+/))return i.parent().find(".member-username").text()}return null},BdApi.setPlaying=function(e){bdws.send({op:3,d:{idle_since:null,game:{name:e}}})},BdApi.setStatus=function(e,t){bdws.send({op:3,d:{idle_since:e,game:{name:t}}})};